# å‰è¨€

è¿™ç¯‡æ–‡ç« çš„åŸå› ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š

- ç¬¬ä¸€ä¸ªæ–¹é¢æ˜¯å› ä¸ºåœ¨å‰å‡ ç¯‡æ–‡ç« ä¸­ï¼Œåœ¨è®²**ç±»åŠ è½½å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€ç±»åŠ è½½å™¨çš„å¯åŠ¨æ—¶æœº**è¿™ä¸¤å—å†…å®¹æ—¶ç©¿æ’äº†ä¸å°‘çš„HotSpotæºç ï¼Œè‚¯å®šä¼šæœ‰å°ä¼™ä¼´**æƒ³è‡ªå·±è·Ÿä¸€ä¸‹HotSpotæºç **ï¼Œæ‰€ä»¥åœ¨è¿™ä¸“é—¨å†™ä¸€ç¯‡**HotSpotæºç é˜…è¯»ç¯å¢ƒ**çš„æ–‡ç« ç»™éœ€è¦çš„å°ä¼™ä¼´

- å…¶æ¬¡åœ¨ä¹‹åçš„æ–‡ç« ä¸­ä¼šè®²**å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€åƒåœ¾å›æ”¶ç®—æ³•ã€GCå®‰å…¨ç‚¹å’Œå®‰å…¨åŒºåŸŸã€åƒåœ¾å›æ”¶å™¨**ç­‰ç­‰ä¸€ç³»åˆ—çš„å†…å®¹ä¸­ï¼Œéš¾å…ä¼šæ‰¯åˆ°**HotSpotæºç **ä¸­å»ï¼Œæ‰€ä»¥è¿˜ä¸å¦‚ç°åœ¨å°±æŠŠ**æºç é˜…è¯»ç¯å¢ƒæ­å»ºå¥½**ï¼Œåˆ°æ—¶å€™è·Ÿç€æ–‡ç« çš„æ€è·¯ä¸€æ­¥æ­¥çš„è·Ÿä¸‹æ¥å‘¢

- æœ€åä¸€ä¸ªæ–¹é¢åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ï¼š**å°ä¼™ä¼´çœŸçš„å¯¹JVMä¸æ„Ÿå…´è¶£å—ï¼Ÿ**

é‚£ä¹ˆè¯ä¸å¤šè¯´ï¼Œå¼€å§‹å‡†å¤‡æ­å»ºå§ï¼ï¼ï¼

# å‡†å¤‡å·¥ä½œ

## ç¬¬ä¸€ä¸ªç¯èŠ‚ï¼šè½¯ä»¶å‡†å¤‡

æˆ‘è¿™é‡Œé’ˆå¯¹çš„æ˜¯æˆ‘è‡ªå·±çš„ç¯å¢ƒï¼Œæ‚¨å¯ä»¥æ ¹æ®ä½ è‡ªå·±çš„ç¯å¢ƒï¼Œå»æ­å»ºï¼Œé“ç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚

- OSï¼šMacç³»ç»Ÿ
- IDEï¼šClion
- æºç ï¼šOpenJDK8

## ç¬¬äºŒä¸ªç¯èŠ‚ï¼šç¯å¢ƒæ­å»º

### IDE Clion

é¦–å…ˆä½ å¾—å®‰è£…ä¸€ä¸ªClionï¼Œå› ä¸ºHotSpotè™šæ‹Ÿæœºæ˜¯C++å†™çš„ï¼Œ[é“¾æ¥åœ¨è¿™ï¼Œè¯·ç‚¹æˆ‘](https://www.jetbrains.com/clion/download/#section=mac)

#### æµ‹è¯•IDE Clionå¯ç”¨

å®‰è£…å®ŒClionåï¼Œéšä¾¿æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œç¡®ä¿Clionæ˜¯æ­£å¸¸èƒ½ä½¿ç”¨çš„

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e33cc8b14e64f14aabb124a0731f081~tplv-k3u1fbpfcp-watermark.image)


æˆ‘ä»¬ç‚¹å‡»createä¹‹åï¼Œå‘ç°æŠ¥ä¸‹é¢æˆªå›¾ä¸­çš„é”™ï¼Œå…³é”®åœ¨`missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun`è¿™è¡Œé”™è¯¯ä»£ç ï¼Œç™¾åº¦ä¸€ä¸‹è¯´æ˜¯ç¼ºå°‘**Command Line Toolså·¥å…·**ï¼Œé‚£ä¹ˆå°±ä¸‹è½½ä¸€ä¸‹è¿™ä¸ªå·¥å…·

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/937e088f9dba464ca74dadbab7dceebe~tplv-k3u1fbpfcp-watermark.image)


##### å®‰è£…Command Line Tools

è¿›å…¥è‹¹æœçš„å¼€å‘è€…ç½‘ç«™ï¼š[è¯·ç‚¹è¿™è¿›å…¥](https://developer.apple.com/download/more/)ï¼Œè¿›è¡Œä¸‹è½½ï¼Œä¸‹è½½åå®‰è£…pkgæ–‡ä»¶å³å¯

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63f25a1cca264f7bbce44f5b0e69e01b~tplv-k3u1fbpfcp-watermark.image)


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c38021b835354db4a4d4b9ec7e8e0f13~tplv-k3u1fbpfcp-watermark.image)


å®‰è£…å®Œä¹‹åï¼Œæ‰“å¼€Clionï¼Œå‘ç°åŸå…ˆæŠ¥é”™çš„åœ°æ–¹éƒ½ç½®ç°äº†ï¼Œè¯´æ˜å·²ç»ä¿®å¤äº†


![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e7a384498294e1b86b2db44e7a2d578~tplv-k3u1fbpfcp-watermark.image)

è¿è¡Œmainå‡½æ•°åï¼Œä¹Ÿæ­£å¸¸è¾“å‡ºäº†ï¼Œè¯´æ˜Clionå·²ç»æ­£ç¡®å®‰è£…

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/24d11bf4e49d46d38c2ce140acdc602d~tplv-k3u1fbpfcp-watermark.image)


### ä¸‹è½½openjdkæºç 

IDEå‡†å¤‡å¥½äº†ï¼Œä¸‹ä¸€æ­¥å°±éœ€è¦å‡†å¤‡openjdkæºç äº†ï¼Œç”±äº`å®˜ç½‘ä¸‹è½½ç½‘é€Ÿå¤ªæ…¢ï¼Œå®¹æ˜“æ–‡ä»¶ä¸‹ä¸å…¨`ï¼Œæˆ‘å°±ç›´æ¥åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªç¤¾åŒºç»´æŠ¤çš„openjdk-jdk8uç‰ˆæœ¬

[ç¤¾åŒºç»´æŠ¤çš„openjdk-jdk8u](https://github.com/AdoptOpenJDK/openjdk-jdk8u)

## ç¬¬ä¸‰ä¸ªç¯èŠ‚ï¼šç¼–è¯‘æºç 

ä¸‹è½½å®Œæœ€æ–°çš„openjdkæºç ä¹‹åï¼Œå°±éœ€è¦å¯¹å®ƒè¿›è¡Œç¼–è¯‘

### å‡†å¤‡ç¼–è¯‘å·¥å…·

```
// åŠ é€Ÿç¼–è¯‘
brew install ccache  
// å­—ä½“å¼•æ“ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šè¢«ä¾èµ–åˆ°
brew install freetype 
brew install autoconf
// åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶
brew install mercurial
```

### é…ç½®BOOT_JDK`å¾ˆé‡è¦ï¼Œä¸ç„¶ç¼–è¯‘ä¼šæŠ¥å‡ºå„ç§åƒå¥‡ç™¾æ€ªçš„é—®é¢˜`

ç¼–è¯‘ä¹‹å‰éœ€è¦é…ç½®ä¸€ä¸ªç§°ä½œBOOT_JDKçš„ä¸œè¥¿ï¼Œå…¶ç‰ˆæœ¬è¦æ¯”ç¼–è¯‘çš„ç‰ˆæœ¬ä½ä¸€çº§ï¼Œå³ç¼–è¯‘OpenJDK8ï¼Œå°±éœ€è¦å®‰è£…JDK7ä½œä¸ºç¯å¢ƒ**OpenJDK7æˆ–OracleJDK7å‡å¯**


### å®‰è£…compiledb`å¾ˆé‡è¦ï¼Œè§£å†³å¤´æ–‡ä»¶è´¹äº†å°†è¿‘ä¸¤å¤©ï¼Œæœ€åå‘ç°å®‰è£…è¿™ç©æ„å°±å¥½äº†ï¼Œæˆ‘åè¡€äº†`

å…¶å®è¿™ä¸€æ­¥çš„æ“ä½œçš„åŸå› æ˜¯ä¸ºäº†è§£å†³åœ¨ç¼–è¯‘openjdkæºç çš„æ—¶å€™å¾ˆå¤šå¤´æ–‡ä»¶æ‰¾ä¸åˆ°çš„é—®é¢˜

å®‰è£…è¦æ±‚ï¼šéœ€è¦python3+ï¼Œ**brew install python3**

ç„¶åéœ€è¦å®‰è£…pipï¼Œå®‰è£…æŒ‡ä»¤ä¸ºï¼š**curl https://bootstrap.pypa.io/get-pip.py | python3**

æœ€åé€šè¿‡**pipå®‰è£…compiledb**å³å¯ï¼ŒæŒ‡ä»¤ä¸ºï¼š**pip install compiledb**


### é…ç½®ç¯å¢ƒå˜é‡

```
vi ~/.bash_profile
```

åœ¨.bash_profileæ–‡ä»¶åº•éƒ¨æ’å…¥ä¸‹é¢çš„é…ç½®ä¿¡æ¯ï¼š

```
# è®¾å®šè¯­è¨€é€‰é¡¹ï¼Œå¿…é¡»è®¾ç½®
export LANG=C
# Macå¹³å°ï¼ŒCç¼–è¯‘å™¨ä¸å†æ˜¯GCCï¼Œè€Œæ˜¯clang
export CC=clang
export CXX=clang++
export CXXFLAGS=-stdlib=libc++
# æ˜¯å¦ä½¿ç”¨clangï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯GCCç¼–è¯‘ï¼Œè¯¥é€‰é¡¹åº”è¯¥è®¾ç½®ä¸ºfalse
export USE_CLANG=true
# è·³è¿‡clangçš„ä¸€äº›ä¸¥æ ¼çš„è¯­æ³•æ£€æŸ¥ï¼Œä¸ç„¶ä¼šå°†Nå¤šçš„è­¦å‘Šä½œä¸ºError
export COMPILER_WARNINGS_FATAL=false
# é“¾æ¥æ—¶ä½¿ç”¨çš„å‚æ•°
export LFLAGS='-Xlinker -lstdc++'
# ä½¿ç”¨64ä½æ•°æ®æ¨¡å‹
export LP64=1
# å‘Šè¯‰ç¼–è¯‘å¹³å°æ˜¯64ä½ï¼Œä¸ç„¶ä¼šæŒ‰ç…§32ä½æ¥ç¼–è¯‘
export ARCH_DATA_MODEL=64
# å…è®¸è‡ªåŠ¨ä¸‹è½½ä¾èµ–
export ALLOW_DOWNLOADS=true
# å¹¶è¡Œç¼–è¯‘çš„çº¿ç¨‹æ•°ï¼Œç¼–è¯‘æ—¶é•¿ï¼Œä¸ºäº†ä¸å½±å“å…¶ä»–å·¥ä½œï¼Œå¯ä»¥é€‰æ‹©2
export HOTSPOT_BUILD_JOBS=4
export PARALLEL_COMPILE_JOBS=2 #ALT_PARALLEL_COMPILE_JOBS=2
# æ˜¯å¦è·³è¿‡ä¸å…ˆå‰ç‰ˆæœ¬çš„æ¯”è¾ƒ
export SKIP_COMPARE_IMAGES=true
# æ˜¯å¦ä½¿ç”¨é¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦
export USE_PRECOMPILED_HEADER=true
# æ˜¯å¦ä½¿ç”¨å¢é‡ç¼–è¯‘
export INCREMENTAL_BUILD=true
# ç¼–è¯‘å†…å®¹
export BUILD_LANGTOOL=true
export BUILD_JAXP=true
export BUILD_JAXWS=true
export BUILD_CORBA=true
export BUILD_HOTSPOT=true
export BUILD_JDK=true
# ç¼–è¯‘ç‰ˆæœ¬
export SKIP_DEBUG_BUILD=true
export SKIP_FASTDEBUG_BULID=false
export DEBUG_NAME=debug
# é¿å¼€javawså’Œæµè§ˆå™¨Javaæ’ä»¶ä¹‹ç±»éƒ¨åˆ†çš„build
export BUILD_DEPLOY=false
export BUILD_INSTALL=false

# æœ€åéœ€è¦å¹²æ‰è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼ˆå¦‚æœä½ é…ç½®è¿‡ï¼‰ï¼Œä¸ç„¶ä¼šå‘ç”Ÿè¯¡å¼‚çš„äº‹ä»¶
unset JAVA_HOME
unset CLASSPATH
```

ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š

```
source ~/.bash_profile
```

### æ‰§è¡Œé…ç½®æ–‡ä»¶æ ¡éªŒå‘½ä»¤

è¿›å…¥ä¸‹è½½çš„openjdkç›®å½•ï¼Œæ‰§è¡Œé…ç½®æ–‡ä»¶æ ¡éªŒå‘½ä»¤`æ³¨æ„ï¼šä¸€å®šè¦åˆ‡æ¢åˆ°BOOT_JDKçš„ç‰ˆæœ¬ä¸‹æ‰§è¡Œ`

```
sh configure --with-freetype-include=/usr/local/include/freetype2 --with-freetype-lib=/usr/local/lib/ --disable-zip-debug-info --disable-debug-symbols --with-debug-level=slowdebug --with-target-bits=64 --with-jvm-variants=server
```

#### æ‰§è¡Œé…ç½®æ–‡ä»¶æŠ¥é”™æ¡ˆä¾‹

1. æ‰§è¡Œä¹‹åæŠ¥ä¸‹å›¾ä¸­çš„é”™ï¼Œæ„æ€å°±æ˜¯**æ£€æµ‹ä¸åˆ°Xcodeçš„ç‰ˆæœ¬**

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df2a800ef08b4903ad645c6851cd8120~tplv-k3u1fbpfcp-watermark.image)

`è§£å†³åŠæ³•`ï¼šå»è‹¹æœçš„å¼€å‘è€…ç½‘ç«™ï¼š[è¯·ç‚¹è¿™è¿›å…¥](https://developer.apple.com/download/more/)ä¸‹è½½macç³»ç»Ÿç‰ˆæœ¬å¯¹åº”çš„Xcodeï¼Œä¸‹è½½å®ŒXcodeä¹‹åè®°å¾—`æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤`ï¼Œä¸ç„¶è¿˜æ˜¯ä¼šæŠ¥ä¸Šå›¾ä¸­çš„é”™

```
sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
```

2. `Xcode 4 is required to build JDK 8`çš„é”™

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a71d8f09c5ce4f868fdb556cef407a9e~tplv-k3u1fbpfcp-watermark.image)


`è§£å†³åŠæ³•`ï¼šæ‰¾åˆ°configureæ–‡ä»¶å¹¶æ‰“å¼€`vim common/autoconf/generated-configure.sh`,æ‰¾åˆ°åˆ¤æ–­ç‰ˆæœ¬çš„åœ°æ–¹,å°†è¿™ä¸€æ®µå…¨éƒ¨æ³¨é‡Šæ‰.

```
    #Fail-fast: verify we're building on Xcode 4, we cannot build with Xcode 5 or later
    XCODE_VERSION=`$XCODEBUILD -version | grep '^Xcode ' | sed 's/Xcode //'`XC_VERSION_PARTS=( ${XCODE_VERSION//./ } )
    if test ! "${XC_VERSION_PARTS[0]}" = "4"; then
     as_fn_error $? "Xcode 4 is required to build JDK 8, the version found was  $XCODE_VERSION. Use --with-xcode-path to specify the location of Xcode 4 or make Xcode 4 active by using xcode-select." "$LINENO" 5
    fi
#
```

3. `A gcc compiler is required`çš„é—®é¢˜

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/42433bfc63b34047840cb8fc040cfa49~tplv-k3u1fbpfcp-watermark.image)

`è§£å†³åŠæ³•`ï¼šæ‰¾åˆ°ä¸‹é¢è¿™æ®µæ ¡éªŒä»£ç å¹¶æ³¨é‡Šæ‰ï¼Œ**æ³¨æ„æœ‰ä¸¤å¤„ï¼Œä»£ç æ˜¯ç›¸åŒçš„ï¼Œæ ¹æ®ä¸‹å›¾ä¸­çš„æ ‡å¿—å¯»æ‰¾**

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/54123aeeab844206996700bdac6c5bfd~tplv-k3u1fbpfcp-watermark.image)

```
    if test $? -ne 0; then
      { $as_echo "$as_me:${as_lineno-$LINENO}: The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required GCC compiler." >&5
$as_echo "$as_me: The $COMPILER_NAME compiler (located as $COMPILER) does not seem to be the required GCC compiler." >&6;}
      { $as_echo "$as_me:${as_lineno-$LINENO}: The result from running with --version was: \"$COMPILER_VERSION_TEST\"" >&5
$as_echo "$as_me: The result from running with --version was: \"$COMPILER_VERSION_TEST\"" >&6;}
      as_fn_error $? "GCC compiler is required. Try setting --with-tools-dir." "$LINENO" 5
    fi
```

å‡ºç°ä¸‹å›¾çš„æ ·å­ï¼Œè¯æ˜æ ¡éªŒå®Œæˆï¼Œ**æ³¨æ„ï¼šè¦ç¡®è®¤Boot JDKçš„ç‰ˆæœ¬**

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7aaaa6b0858e47b390cab8c99510f8b5~tplv-k3u1fbpfcp-watermark.image)

### å¼€å§‹ç¼–è¯‘`æ¯ä¸€æ¬¡ç¼–è¯‘éƒ½è¦è€—è´¹å¾ˆå¤šçš„æ—¶é—´ï¼Œæ‰€ä»¥å»ºè®®æŠŠæ–‡ä¸­çš„é”™è¯¯éƒ½æ”¹äº†ä¹‹åï¼Œå†è¿›è¡Œç¼–è¯‘`

æ‰§è¡Œ**compiledb make WARNINGS_ARE_ERRORS="" CONF=macosx-x86_64-normal-server-slowdebug all**å‘½ä»¤è¿›è¡Œç¼–è¯‘

å¦‚æœå‡ºé”™çš„è¯ï¼Œä¸€å®šè¦æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤é‡æ–°ç¼–è¯‘ï¼š

1. **compiledb make CONF=macosx-x86_64-normal-server-slowdebug clean**
2. **compiledb make WARNINGS_ARE_ERRORS="" CONF=macosx-x86_64-normal-server-slowdebug all**

```
compiledb make WARNINGS_ARE_ERRORS="" CONF=macosx-x86_64-normal-server-slowdebug all
```

#### ç¼–è¯‘çš„æŠ¥é”™æ¡ˆä¾‹

1. `fatal error: 'iostream' file not foundçš„é—®é¢˜`ï¼šè§£å†³æ–¹æ¡ˆï¼šè®¾ç½®ç¯å¢ƒå˜é‡

```
NEW_INCLUDE=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1
export CFLAGS=-I$NEW_INCLUDE
export CXXFLAGS=-I$NEW_INCLUDE
```

2. `library not found for -lstdc++çš„é—®é¢˜`ï¼šè§£å†³æ–¹æ¡ˆï¼šæŒ‰ç…§å¦‚ä¸‹ä»æ“ä½œå³å¯ã€‚

- å…‹éš†ä¸€ä¸ªå·¥å…·ï¼š`git clone https://github.com/quantum6/xcode-missing-libstdcpp`**ï¼ˆæ³¨æ„ï¼šè¯¥æ–‡ä»¶çš„å†…å®¹ä¼šè½¯è¿æ¥åˆ°Xcodeä¸­ï¼Œæ‰€ä»¥è¯¥ç›®å½•ä¸èƒ½åˆ é™¤ï¼‰**
- ç„¶åè¿›å…¥è¯¥å·¥å…·æ‰§è¡Œsh install.sh
- é…ç½®ç¯å¢ƒå˜é‡

```
NEW_LIB=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/lib
export LDFLAGS="-L${NEW_LIB}"
export LIBRARY_PATH=$NEW_LIB:$LIBRARY_PATH
```

3. `symbol(s) not found for architecture x86_64`çš„é—®é¢˜ï¼šè§£å†³æ–¹æ¡ˆï¼šæ‰¾åˆ°æ–‡ä»¶`jdk/src/macosx/native/sun/osxapp/ThreadUtilities.m`ï¼Œç„¶åæŠŠ`inline void attachCurrentThread(void** env) æ”¹ä¸ºstatic inline void attachCurrentThread(void** env) `

```
Undefined symbols for architecture x86_64:
  "_attachCurrentThread", referenced from:
      +[ThreadUtilities getJNIEnv] in ThreadUtilities.o
      +[ThreadUtilities getJNIEnvUncached] in ThreadUtilities.o
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
```

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58c35857aed64d0c8386391f85650da2~tplv-k3u1fbpfcp-watermark.image)

4. `clang: error: unknown argument: '-fpch-deps'`çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆï¼šç¼–è¾‘`hotspot/make/bsd/makefiles/gcc.make` æ³¨é‡Šä»¥ä¸‹ä»£ç 

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52e2b4f482374c1791cf84869a0f0846~tplv-k3u1fbpfcp-watermark.image)

```
ifeq ($(USE_CLANG),)
  ifneq ($(CC_VER_MAJOR), 2)
    DEPFLAGS += -fpch-deps
  endif
endif
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f038a0426df54ddbaa4bdf117e6bd75b~tplv-k3u1fbpfcp-watermark.image)

5. `error: invalid argument '-std=gnu++98' not allowed with 'C'`çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆ:ç¼–è¾‘`common/autoconf/generated-configure.sh`,æœç´¢`-std=gnu++98`è¿™ä¸ªå­—ä¸²å¹¶æ³¨é‡Š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cecaa7d240e24909ad42fc5c38543ef6~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbf4d06eff534618b124d9511aaee935~tplv-k3u1fbpfcp-watermark.image)

6. è§£å†³åœ¨slowdebugæ¨¡å¼ä¸‹ç¼–è¯‘ä¹‹åå´©æºƒçš„é—®é¢˜ï¼šåœ¨slowdebugæ¨¡å¼ä¸‹ç¼–è¯‘å®Œæˆä¹‹åï¼Œæ‰§è¡Œjava -versionåä¼šæœ‰JVMå¥”æºƒçš„é”™è¯¯ã€‚æ‰¾åˆ°æ–‡ä»¶`hotspot/src/share/vm/runtime/perfMemory.cpp`æ–‡ä»¶ã€‚æ³¨é‡Šæ‰å¦‚ä¸‹å†…å®¹ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5cb0a37dc12486abe0bf28263487eba~tplv-k3u1fbpfcp-watermark.image)

7. `implicit declaration of function 'VerifyFixClassname' is invalid in C99`çš„é—®é¢˜ï¼šè§£å†³æ–¹æ¡ˆï¼šincludeå¤´æ–‡ä»¶æˆ–è€…ç›´æ¥å¤–éƒ¨å£°æ˜**æœ€å¥½includeå¤´æ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°å†ç›´æ¥å£°æ˜**

```
extern jboolean VerifyFixClassname(char* name);
extern jboolean VerifyClassname(char* name, jboolean allowArrayClass);
```

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b0348a91255742e0914f999a297a2861~tplv-k3u1fbpfcp-watermark.image)

8. `implicit declaration of function 'pthread_main_np' is invalid in C99`çš„é—®é¢˜ï¼šå’Œä¸Šé¢ä¸€æ ·**æœ€å¥½includeå¤´æ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°å†ç›´æ¥å£°æ˜**

```
extern jboolean pthread_main_np();
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5dafd500bb3a47b5a99bd8c553f9257f~tplv-k3u1fbpfcp-watermark.image)


9. `implicitly declaring library function 'strchr' with type 'char *(const char *, int)'`çš„é—®é¢˜ï¼šå’Œä¸Šé¢ä¸€æ ·**æœ€å¥½includeå¤´æ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°å†ç›´æ¥å£°æ˜**

```
#include <stdio.h>
#include <string.h>
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/296b8161f4da484e88d94dba809fc01a~tplv-k3u1fbpfcp-watermark.image)

10. `implicit declaration of function 'time' is invalid in C99`çš„é—®é¢˜ï¼šå’Œä¸Šé¢ä¸€æ ·**æœ€å¥½includeå¤´æ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°å†ç›´æ¥å£°æ˜**

```
#include <time.h>
```
![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b78584df85a44279025e8f62d57f2be~tplv-k3u1fbpfcp-watermark.image)

11. `implicit declaration of function 'JVM_ActiveProcessorCount' is invalid in C99`çš„é—®é¢˜ï¼šè¿™é‡Œç›´æ¥æ”¹æˆ`jint ncpus = 4;`

```
jint ncpus = 4;
```
![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7dc89f6134ce440e8b91ccf1d8aa753f~tplv-k3u1fbpfcp-watermark.image)


## ç¬¬å››ä¸ªç¯èŠ‚ï¼šå‘Clionä¸­å¯¼å…¥æºç å¹¶é…ç½®

å¦‚æœå‡ºç°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç•Œé¢ï¼Œè¯´æ˜å·²ç»`ç¼–è¯‘æˆåŠŸ`ï¼Œåœ¨ç¼–è¯‘åæœ‰å¯èƒ½åœ¨æœ€åæœ‰å¤§é‡çš„`No such file or directoryçš„è­¦å‘Šã€‚`è¿™ä¸ªä¸ç”¨æ‹…å¿ƒï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å‘Clionä¸­å¯¼å…¥ç¼–è¯‘åçš„æºç 

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ffa1eab601564ce5a5418b7ea48af546~tplv-k3u1fbpfcp-watermark.image)

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d50956ad9ab64d41a3772e3e32c7692e~tplv-k3u1fbpfcp-watermark.image)


ç”±äºä½¿ç”¨äº†**compiledbåŒ…è£…ç¼–è¯‘OpenJDKæºç **ã€‚æ‰€ä»¥ç¼–è¯‘å®Œæˆä¹‹åæˆ‘ä»¬åœ¨æºç æ ¹ç›®å½•å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ª`compile_commands.jsonæ–‡ä»¶`ã€‚æˆ‘ä»¬çš„å·¥ç¨‹å¯¼å…¥åˆ™ä¾èµ–è¿™ä¸ªjsonæ–‡ä»¶ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c9d2c2a66184362af5b76b6c016fe80~tplv-k3u1fbpfcp-watermark.image)


æ‰“å¼€Clionï¼Œç„¶åç‚¹å‡»Openæ‰“å¼€ä¸Šè¿°`compile_commands.jsonæ–‡ä»¶`ï¼Œå¹¶åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­é€‰æ‹©Open as Projectã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/11fce2eeeafb40b68d0758bd4402dee3~tplv-k3u1fbpfcp-watermark.image)

`ç­‰å¾…å¯¼å…¥æˆåŠŸå`ï¼Œè¿›å…¥Clionçš„`preferences->Build,Execution,Deployment->Custom Build Targets`ï¼Œåœ¨æ”¹é…ç½®é¡µé¢ç‚¹å‡»`Add Target`é…ç½®è‡ªå®šä¹‰çš„`Build Targets`ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75dafcb6fc6044c1bc3768212f273250~tplv-k3u1fbpfcp-watermark.image)

nameè‡ªå·±è‡ªè¡Œè¾“å…¥ï¼ŒToolchainé€‰æ‹©Default

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19ebfecdb4c0492e97ae7aa8dde70f17~tplv-k3u1fbpfcp-watermark.image)

æ–°å»ºToolï¼Œä¸€ä¸ªæ˜¯make_jdk8ï¼Œä¸€ä¸ªæ˜¯clean_jdk8ï¼Œ**ï¼ˆåå­—éƒ½è‡ªè¡Œå–ä¸€ä¸ªå°±è¡Œï¼‰**

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3bc81d0e081445ecadcc2820b4ad7c0e~tplv-k3u1fbpfcp-watermark.image)

make_jdk8: å…¶ä¸­argumentså¡«å†™ï¼š`CONF=macosx-x86_64-normal-server-slowdebugï¼ŒWorking directoryåˆ™æ·»åŠ æºç çš„æ ¹ç›®å½•ã€‚`


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b1ad08f2a2a4467ae1e98a01a33f263~tplv-k3u1fbpfcp-watermark.image)

clean_jdk8: å…¶ä¸­argumentså¡«å†™ï¼š`CONF=macosx-x86_64-normal-server-slowdebug cleanï¼ŒWorking directoryåˆ™æ·»åŠ æºç çš„æ ¹ç›®å½•ã€‚`

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74e471671c7846d596706f628919ed11~tplv-k3u1fbpfcp-watermark.image)

ç„¶åå†Clutom Build Targetså®Œæ•´å…·ä½“é…ç½®ï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7513c650c52f4a879177ffbb702e6adc~tplv-k3u1fbpfcp-watermark.image)


æ¥ç€åœ¨Clionä¸»é¡µé¢ç‚¹å‡»`Add Configuration`,æ–°å¢é…ç½®`Run/Debug Configurationsã€‚`

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f542ff35c08465ea57f53b1083f0cd3~tplv-k3u1fbpfcp-watermark.image)


## ç¬¬äº”ä¸ªç¯èŠ‚ï¼šå¼€å§‹è°ƒè¯•

åœ¨å®Œæˆæ‰€æœ‰é…ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è°ƒè¯•ä»£ç äº†ã€‚é¦–å…ˆåœ¨jni.cppçš„create_vmä¸­æ·»åŠ æ‰“ä¸€ä¸ªæ–­ç‚¹ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/272ca76522a44d1d9499944f4fede24d~tplv-k3u1fbpfcp-watermark.image)

åˆ°æ­¤debugçš„è°ƒè¯•è®¾ç½®å¥½äº†ï¼ŒHotSpotæºç é˜…è¯»ç¯å¢ƒä¹Ÿå°±æ­å»ºå®Œäº†ï¼Œå¸Œæœ›å¤§å®¶éƒ½èƒ½æˆåŠŸï¼ï¼ï¼


# çµ®å¨

æœ€åï¼Œå¦‚æœæ„Ÿåˆ°æ–‡ç« æœ‰å“ªé‡Œå›°æƒ‘çš„ï¼Œè¯·ç¬¬ä¸€æ—¶é—´ç•™ä¸‹è¯„è®ºï¼Œå¦‚æœå„ä½çœ‹å®˜è§‰å¾—**å°æ²™å¼¥**æˆ‘æœ‰ç‚¹ä¸œè¥¿çš„è¯ æ±‚ç‚¹èµğŸ‘ æ±‚å…³æ³¨â¤ï¸ æ±‚åˆ†äº«ğŸ‘¥ å¯¹æˆ‘æ¥è¯´çœŸçš„ éå¸¸æœ‰ç”¨ï¼ï¼ï¼å¦‚æœæƒ³è·å–æµ·é‡Javaèµ„æº**å¥½ç”¨çš„ideaæ’ä»¶ã€ç®€å†æ¨¡æ¿ã€è®¾è®¡æ¨¡å¼ã€å¤šçº¿ç¨‹ã€æ¶æ„ã€ç¼–ç¨‹é£æ ¼ã€ä¸­é—´ä»¶......**ï¼Œå¯ä»¥å…³æ³¨å¾®ä¿¡å…¬ä¼—å·**Javaç™¾ç§‘å…¨ä¹¦**ï¼Œæœ€åçš„æœ€åï¼Œæ„Ÿè°¢å„ä½çœ‹å®˜çš„æ”¯æŒï¼ï¼ï¼



